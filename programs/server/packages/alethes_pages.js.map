{"version":3,"sources":["alethes:pages/lib/pages.coffee"],"names":[],"mappings":"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","file":"/packages/alethes:pages.js","sourcesContent":["@__Pages = class Pages\n\n  settings:\n    \n    #settingName: [canBeMadeAvailableToTheClient, expectedTypes(s), defaultValue]\n    \n    dataMargin: [true, Number, 3]\n    divWrapper: [true, Match.OneOf(\n      Match.Optional(String)\n      Match.Optional(Boolean)\n    ), \"pagesCont\"] #If defined, should be a name of the wrapper's CSS classname\n    fields: [true, Object, {}]\n    filters: [true, Object, {}]\n    itemTemplate: [true, String, \"_pagesItemDefault\"]\n    navShowEdges: [true, Boolean, false] #If true, overrides navShowFirst and navShowLast\n    navShowFirst: [true, Boolean, true] #If true, overrides navShowEdges\n    navShowLast: [true, Boolean, true] #If true, overrides navShowEdges\n    resetOnReload: [true, Boolean, false]\n    paginationMargin: [true, Number, 3]\n    perPage: [true, Number, 10]\n    #requestTimeout: [true, Number, 2]\n    route: [true, String, \"/page/\"]\n    router: [true, Match.Optional(String), undefined] #Can be any type. Use only in comparisons. Expects String or Boolean\n    routerTemplate: [true, String, \"pages\"]\n    routerLayout: [true, Match.Optional(String), undefined]\n    sort: [true, Object, {}]\n    \n    # Unavailable to the client after initialization\n    \n    auth: [false, Match.Optional(Function), undefined]\n    availableSettings: [false, Object, {}]\n    fastRender: [false, Boolean, false]\n    homeRoute: [false, Match.OneOf(String, Array, Boolean), \"/\"]\n    infinite: [false, Boolean, false]\n    infiniteItemsLimit: [false, Number, Infinity]\n    infiniteTrigger: [false, Number, .9]\n    infiniteRateLimit: [false, Number, 1]\n    navTemplate: [false, String, \"_pagesNavCont\"]\n    onDeniedSetting: [false, Function, (k, v, e) -> console?.log \"Changing #{k} not allowed.\"]\n    pageSizeLimit: [false, Number, 60]\n    pageTemplate: [false, String, \"_pagesPageCont\"]\n    rateLimit: [false, Number, 1]\n    routeSettings: [false, Match.Optional(Function), undefined]\n    table: [false, Match.OneOf(Boolean, Object), false]\n    tableItemTemplate: [false, String, \"_pagesTableItem\"]\n    tableTemplate: [false, String, \"_pagesTable\"]\n    templateName: [false, Match.Optional(String), undefined] #Defaults to collection name\n  \n  # Prototype variables (shared between instances)\n  \n  _nInstances: 0\n  collections: {}\n  instances: {}\n  \n  methods:\n    \n    \"CountPages\": (sub) ->\n      n = sub.get \"nPublishedPages\"\n      return n  if n?\n\n      n = Math.ceil @Collection.find(\n        $and: [\n          sub.get(\"filters\"),\n          sub.get(\"realFilters\") or {}\n        ]\n      ).count() / (sub.get \"perPage\")\n      n or 1\n    \n    \"Set\": (k, v, sub) ->\n      if !@settings[k]?\n        @error 4003, \"Invalid option: #{k}.\"\n      check k, String\n      check v, @settings[k][1]\n      check sub, Match.Where (sub) ->\n        sub.connection?.id?\n\n      if !@availableSettings[k] or (_.isFunction(@availableSettings[k]) and !@availableSettings[k] v, sub)\n        @error 4002, \"Changing #{k} not allowed.\"\n      \n      changes = 0\n      if v?\n        changes = @_set k, v, cid: sub.connection.id\n      else if !_.isString k\n        for _k, _v of k\n          changes += @set _k, _v, cid: sub.connection.id\n      changes\n    \n    \"Unsubscribe\": ->\n      subs = []\n      for i, k in @subscriptions\n        if i.connection.id is arguments[arguments.length - 1].connection.id\n          i.stop()\n        else\n          subs.push i\n      @subscriptions = subs\n      true\n  \n  constructor: (collection, settings = {}) ->\n    unless @ instanceof Meteor.Pagination\n      throw new Meteor.Error 4000, \"The Meteor.Pagination instance has to be initiated with `new`\"\n    \n    # Instance variables\n    \n    @init = true\n    @subscriptions = []\n    @userSettings = {}\n    @_currentPage = 1\n\n    # Setup\n\n    @setCollection collection\n    @setInitial settings\n    @setDefaults()\n    @setRouter()\n    @[(if Meteor.isServer then \"server\" else \"client\") + \"Init\"]()\n    @registerInstance()\n    @\n    \n  error: (code, msg) ->\n    msg = code  if !code?\n    throw new Meteor.Error code, msg\n  \n  # Server initialisation\n  \n  serverInit: ->\n    @setMethods()\n    self = @\n    \n    # Remove the per-connection settings when a client disconnects from the server\n    \n    Meteor.onConnection (connection) =>\n      connection.onClose =>\n        delete @userSettings[connection.id]\n        \n    # Publish the collection that we're paginating, taking a page number as a parameter.\n        \n    Meteor.publish @id, (page) ->\n      self.publish.call self, page, @\n  \n  # Client initialisation\n  \n  clientInit: ->\n    @requested = {}\n    @received = {}\n    @queue = []\n    @setTemplates()\n    @countPages()\n    Tracker.autorun =>\n      Meteor.userId?()\n      @reload()\n    @setInfiniteTrigger()  if @infinite\n  \n  #\n  \n  reload: ->\n    @unsubscribe =>\n      @call \"CountPages\", (e, total) =>\n        @sess \"totalPages\", total\n        p = @currentPage()\n        p = 1  if (not p?) or @resetOnReload or p > total\n        @sess \"currentPage\", false\n        @sess \"currentPage\", p\n  \n  unsubscribe: (cb) ->\n    @call \"Unsubscribe\", =>\n      delete @initPage\n      @subscriptions = []\n      @requested = {}\n      @received = {}\n      @queue = []\n      cb?()\n  \n  setDefaults: ->\n    for k, v of @settings\n      @[k] ?= v[2]  if v[2]?\n  \n  syncSettings: (cb) ->\n    S = {}\n    for k, v of @settings\n      if v[0]\n        S[k] = @[k]\n    @set S, if cb? then {cb: cb.bind(@)} else null\n  \n  # Creates server-side methods for this pagination *instance* by prefixing them with our unique id\n  \n  setMethods: ->\n    nm = {}\n    self = @\n    for n, f of @methods\n      nm[@getMethodName n] = ((f) ->\n        ->\n          arg = (v for k, v of arguments)\n          arg.push @\n          @get = ((self, k) -> self.get k, @connection.id).bind @, self\n          r = f.apply self, arg\n          r\n      )(f)\n      \n    Meteor.methods nm\n  \n  # Get's the server's method name for this pagination instance\n  \n  getMethodName: (name) ->\n    \"#{@id}/#{name}\"\n  \n  # Calls this instance's version of a given server method (first argument).\n  # If the last argument is a function callback, it's bound to this instance\n    \n  call: (args...) ->\n    check args, Array\n    if args.length < 1\n      @error 4001, \"Method name not provided in a method call.\"\n    args[0] = @getMethodName args[0]\n    last = args.length - 1\n    if _.isFunction args[last]\n      args[last] = args[last].bind @\n    Meteor.call.apply @, args\n  \n  # Sets/gets a session variable for this instance\n  \n  sess: (k, v) ->\n    return  if !Session?\n    k = \"#{@id}.#{k}\"\n    if arguments.length is 2\n      Session.set k, v\n    else\n      Session.get k\n      \n  # Gets a given setting\n  #      \n  # When there's a connection id we store this setting on a per-connection basis, otherwise we just\n  # set the setting on this pagination instance\n\n  get: (setting, connectionId) ->\n    @userSettings[connectionId]?[setting] ? @[setting]\n  \n # Sets the options for this instance\n    \n  set: (k, opts...) ->\n    ch = 0\n    switch opts.length\n      when 0\n        # set <object> (set the value of each property in object)\n        if _.isObject k\n          for _k, _v of k\n            ch += @_set _k, _v\n      when 1\n        if _.isObject k\n          # set <object>, callback\n          # We wrap the callback and associate with each property of the object being set\n          if _.isFunction opts[0]\n            opts[0] = cb: opts[0]\n          for _k, _v of k\n            ch += @_set _k, _v, opts[0]\n        else\n          # set <name>, <value>\n          check k, String\n          ch = @_set k, opts[0]\n      when 2\n         # set <name>, <value>, [<callback fn>]\n        if _.isFunction opts[1]\n          opts[1] = cb: opts[1]\n        ch = @_set k, opts[0], opts[1]\n      when 3\n        check opts[1], Object\n        check opts[2], Function\n        opts[2] = cb: opts[2]\n        ch = @_set k, opts[1], opts[2]\n    if Meteor.isClient and ch\n      @reload()\n    ch\n\n  setInitial: (settings) ->\n    @setInitDone = false\n    @set settings\n    @setInitDone = true\n\n  #Converts a regular expression into a query object that can be sent via methods to the server\n\n  sanitizeRegex: (v) ->\n    if _.isRegExp v\n      v = v.toString()\n      lis = v.lastIndexOf(\"/\")\n      v = $regex: v[1 ... lis], $options: v[1 + lis .. ]\n    v\n\n  #Sanitizes all regular expressions within an object using ::sanitizeRegex()\n  \n  sanitizeRegexObj: (obj) ->\n    if _.isRegExp obj\n      return @sanitizeRegex obj\n    for k, v of obj\n      if _.isRegExp v\n        obj[k] = @sanitizeRegex v\n      else if \"object\" is typeof v\n        obj[k] = @sanitizeRegexObj v\n    obj\n\n  # Sets a specific option\n      \n  _set: (k, v, opts = {}) ->\n    check k, String\n    ch = 1\n    \n    # Check that we're the server, or that we're being initialised, or that this setting can be changed\n    # after initialization, or that the setting doesn't yet exist on this instance.\n    \n    if Meteor.isServer or !@[k]? or @settings[k]?[0] or opts.init\n    \n      # Check the type of the value against the @settings array\n      if @settings[k]?[1]? and @settings[k]?[1] isnt true\n        check v, @settings[k][1]\n      \n      @sanitizeRegexObj v\n      \n      # Set the parameter on this instance (client)  \n      \n      oldV = @get k, opts?.cid\n\n      return 0  if @valuesEqual v, oldV\n\n      if Meteor.isClient\n        @[k] = v\n        if @setInitDone\n          # Change the setting for the corresponding instance on the server\n          @call \"Set\", k, v, (e, r) ->\n            if e\n              @[k] = oldV\n              return @onDeniedSetting.call @, k, v, e\n            opts.cb? ch\n      else\n        # When there's a connection id we store this setting on a per-connection basis, otherwise we just\n        # set the setting on this pagination instance\n        if opts.cid\n          if ch?\n            @userSettings[opts.cid] ?= {}\n            @userSettings[opts.cid][k] = v\n        else\n          @[k] = v\n        \n        opts.cb? ch\n    else\n      @onDeniedSetting.call @, k, v\n    ch\n    \n  valuesEqual: (v1, v2) ->\n    if _.isFunction v1\n      _.isFunction(v2) and v1.toString() is v2.toString()\n    else\n      _.isEqual v1, v2\n  \n  # \n  \n  setId: (name) ->\n    if @templateName\n      name = @templateName\n    while name of Pages::instances\n      n = name.match /[0-9]+$/\n      if n?\n        name = name[0 ... name.length - n[0].length] + (parseInt(n) + 1)\n      else\n        name = name + \"2\"\n    @id = \"pages_\" + name\n    @name = name\n  \n  #\n  \n  registerInstance: ->\n    Pages::_nInstances++\n    Pages::instances[@name] = @\n  \n  # Set the collection on which this instance operates. Creates a new one if a name is passed in.\n  \n  setCollection: (collection) ->\n    if typeof collection is \"object\"\n      Pages::collections[collection._name] = collection\n      @Collection = collection\n    else\n      try\n        @Collection = new Mongo.Collection collection\n        Pages::collections[collection] = @Collection\n      catch e\n        @Collection = Pages::collections[collection]\n        @Collection instanceof Mongo.Collection or @error 4000, \"The '#{collection}' collection \n        was created outside of <Meteor.Pagination>. Pass the collection object\n        instead of the collection's name to the <Meteor.Pagination> constructor.\"\n    \n    @setId @Collection._name\n    \n    # Create a collection based on the instance's unique id\n    \n    @PaginatedCollection = new Mongo.Collection @id\n  \n  linkTo: (page)->\n    if Router.current()?.params\n      params = Router.current().params\n      params.page = page\n      Router.routes[\"#{@name}_page\"].path params\n  \n  setRouter: ->\n    if @router is \"iron-router\"\n      if @route.indexOf(\":page\") is -1\n        if @route[0] isnt \"/\"\n          @route = \"/\" + @route\n        if @route[@route.length - 1] isnt \"/\"\n          @route += \"/\"\n        pr = @route = \"#{@route}:page\"\n      t = @routerTemplate\n      l = @routerLayout ? undefined\n      self = @\n      init = true\n      \n      Router.map ->\n        unless self.infinite\n        \n          # Create a route that takes a page number\n         \n          @route \"#{self.name}_page\",\n            path: pr\n            template: t\n            layoutTemplate: l\n            onBeforeAction: ->\n              page = parseInt @params.page\n              if self.init\n                self.sess \"oldPage\", page\n                self.sess \"currentPage\", page\n              if self.routeSettings?\n                self.routeSettings @\n              Tracker.nonreactive =>\n                self.onNavClick page\n              @next()               \n        \n        # Create one or more routes for the home (first) page\n              \n        if self.homeRoute\n          if _.isString self.homeRoute\n            self.homeRoute = [self.homeRoute]\n          for hr, k in self.homeRoute\n            @route \"#{self.name}_home#{k}\",\n              path: hr\n              template: t\n              layoutTemplate: l\n              onBeforeAction: ->\n                if self.routeSettings?\n                  self.routeSettings @\n                if self.init\n                  self.sess \"oldPage\", 1\n                  self.sess \"currentPage\", 1\n                @next()\n                      \n      # If using FastRender, set it up for these routes\n                \n      if Meteor.isServer and @fastRender\n        self = @\n        FastRender.route pr, (params) ->\n          @subscribe self.id, parseInt params.page\n        FastRender.route @homeRoute, ->\n          @subscribe self.id, 1    \n  \n  setPerPage: ->\n    @perPage = if @pageSizeLimit < @perPage then @pageSizeLimit else @perPage\n  \n  setTemplates: ->\n    name = @templateName or @name\n    if @table and @itemTemplate is \"_pagesItemDefault\"\n      @itemTemplate = @tableItemTemplate\n    \n    # Create a set of template prefixed by the unique id of this pagination instance\n    # The helper and events are set to those of the base versions of those templates (captured by controllers.coffee)\n    \n    for i in [@navTemplate, @pageTemplate, @itemTemplate, @tableTemplate]\n      tn = @id + i\n      Template[tn] = new Blaze.Template \"Template.#{tn}\", Template[i].renderFunction\n      Template[tn].helpers _TemplateHelpers[i]\n      Template[tn].events _TemplateEvents[i]\n      Template[tn].helpers pagesData: @\n      \n    # Set our helpers on the main template set for this pagination  \n      \n    Template[name].helpers\n      pagesData: @\n      pagesNav: Template[@id + @navTemplate]\n      pages: Template[@id + @pageTemplate]\n  \n  # Get the number of pages from the server\n      \n  countPages: _.throttle ->\n      @call \"CountPages\", ((e, r) ->\n        @sess \"totalPages\", r\n        if @sess(\"currentPage\") > r\n          @sess \"currentPage\", 1\n      ).bind(@)\n    , 500\n  \n  # Called from the Meteor.publish call made during init, this Publishes the paginated collection\n  #\n  # \"this\" will be the pagination instance\n  # \"page\" is the page number to publish\n  # \"sub\" is the publish handler object which (the \"this\" object when the function passed to Meteor.publish is called)\n  \n  publish: (page, sub) ->\n    check page, Number\n    check sub, Match.Where (s) ->\n      s.ready?\n    cid = sub.connection.id\n    \n    # Create get and set functions for this specific connection (the settings will end up in the @userSettings,\n    # stored in an object indexed under the collection id)\n    \n    get = sub.get = ((cid, k) -> @get k, cid).bind(@, cid)\n    set = sub.set = ((cid, k, v) -> @set k, v, cid: cid).bind(@, cid)\n    \n    # If there are already filters set up for this connection id, clear them (is this right?)\n    \n    delete @userSettings[cid]?.realFilters\n    delete @userSettings[cid]?.nPublishedPages\n    \n    @setPerPage()\n    skip = (page - 1) * get \"perPage\"\n    skip = 0 if skip < 0\n    filters = get \"filters\"\n    options = \n      sort: get \"sort\"\n      fields: get \"fields\"\n      skip: skip\n      limit: get \"perPage\"\n    \n    # Call the authentication function if it's supplied\n    \n    if @auth?\n      r = @auth.call @, skip, sub\n      if !r\n        set \"nPublishedPages\", 0\n        sub.ready()\n        return @ready()\n      else if _.isNumber r\n        set \"nPublishedPages\", r\n        if page > r\n          sub.ready()\n          return @ready()\n      else if _.isArray(r) and r.length is 2\n        if _.isFunction r[0].fetch\n          c = r\n        else\n          filters = r[0]\n          options = r[1]\n      else if _.isFunction r.fetch\n        c = r\n    if !EJSON.equals({}, filters) and !EJSON.equals(get(\"filters\"), filters)\n      set \"realFilters\", filters\n    \n    # Get a cursor to the base collection\n    \n    c ?= @Collection.find filters, options\n    \n    init = true\n    self = @\n    \n    # We need to call sub's added callback when a new document is added, however\n    # for the purposes of pagination we also need to include the index of each document.\n    #\n    # Furthermore, an added document might increase the index of other documents on this page.\n    #\n    # We therefore need to use the observe method to handle this.\n    \n    handle = c.observe\n      addedAt: ((sub, doc, at) ->\n        try\n          doc[\"_#{@id}_p\"] = page\n          doc[\"_#{@id}_i\"] = at\n          id = doc._id\n          delete doc._id\n          unless init\n            \n            # Add to @PaginatedCollection\n            \n            sub.added(@id, id, doc)\n            (@Collection.find get(\"filters\"),\n              sort: get \"sort\"\n              fields: get \"fields\"\n              skip: skip\n              limit: get \"perPage\"\n            ).forEach (o, i) =>\n              if i >= at\n                sub.changed(@id, o._id, _.object([[\"_#{@id}_i\", i + 1]]))\n        catch e\n      ).bind @, sub\n    \n    # For the other cases the more efficient observeChanges will suffice...\n      \n    handle2 = c.observeChanges\n      movedBefore: ((sub, id, before) ->\n        at = -1\n        ref = false\n        (@Collection.find get(\"filters\"),\n          sort: get \"sort\"\n          fields: get \"fields\"\n          skip: skip\n          limit: get \"perPage\"\n        ).forEach (o, i) =>\n          if ref\n            sub.changed(@id, o._id, _.object([[\"_#{@id}_i\", i + 1]]))\n          else if o._id is before\n            ref = true\n            at = i\n        sub.changed(@id, id, _.object([[\"_#{@id}_i\", at]]))\n      ).bind @, sub\n      \n      changed: ((sub, id, fields) ->\n        try\n          sub.changed @id, id, fields\n        catch e\n      ).bind @, sub\n      \n      removed: ((sub, id) ->\n        try\n          sub.removed @id, id\n        catch e\n      ).bind @, sub\n    \n    # Add the documents from this query \n    \n    n = 0\n    c.forEach ((doc, index, cursor) ->\n      n++\n      doc[\"_#{@id}_p\"] = page\n      doc[\"_#{@id}_i\"] = index\n      sub.added @id, doc._id, doc\n    ).bind @\n    \n    init = false\n    sub.onStop ->\n      handle.stop()\n      handle2.stop()\n    @ready()\n    @subscriptions.push sub\n    c\n  \n  # Sets the state of the current page as \"loading\" (ready = false)  \n  \n  loading: (p) ->\n    if !@fastRender and p is @currentPage()\n      @sess \"ready\", false\n  \n  now: ->\n    (new Date()).getTime()\n  \n  log: (msg) ->\n    console.log \"#{@name} #{msg}\"\n  \n  logRequest: (p) ->\n    @timeLastRequest = @now()\n    @requesting = p\n    @requested[p] = 1\n  \n  logResponse: (p) ->\n    delete @requested[p]\n    @received[p] = 1\n  \n  clearQueue: ->\n    @queue = []\n  \n  neighbors: (page) ->\n    @n = []\n    if @dataMargin is 0\n      return @n\n    for d in [1 .. @dataMargin]\n      np = page + d\n      if np <= @sess \"totalPages\"\n        @n.push np\n      pp = page - d\n      if pp > 0\n        @n.push pp\n    @n\n  \n  queueNeighbors: (page) ->\n    for p in @neighbors page\n      @queue.push p  if !@received[p] and !@requested[p]\n  \n  paginationNavItem: (label, page, disabled, active = false) ->\n    p: label\n    n: page\n    active: if active then \"active\" else \"\"\n    disabled: if disabled then \"disabled\" else \"\"\n  \n  paginationNeighbors: ->\n    page = @currentPage()\n    total = @sess \"totalPages\"\n    from = page - @paginationMargin\n    to = page + @paginationMargin\n    if from < 1\n        to += 1 - from\n        from = 1\n    if to > total\n        from -= to - total\n        to = total\n    from = 1 if from < 1\n    to = total if to > total\n    n = []\n    if @navShowFirst or @navShowEdges\n      n.push @paginationNavItem \"«\", 1, page == 1\n    n.push @paginationNavItem \"<\", page - 1, page == 1\n    for p in [from .. to]\n      n.push @paginationNavItem p, p, page > total, p is page\n    n.push @paginationNavItem \">\", page + 1, page >= total\n    if @navShowLast or @navShowEdges\n      n.push @paginationNavItem \"»\", total, page >= total\n    for i, k in n\n      n[k]['_p'] = @\n    n\n  \n  onNavClick: (n) ->\n    if n <= @sess(\"totalPages\") and n > 0\n      Tracker.nonreactive =>\n        cp = @sess \"currentPage\"\n        if @received[cp]\n          @sess \"oldPage\", cp\n      @sess \"currentPage\", n\n  \n  setInfiniteTrigger: ->\n    $(window).scroll (_.throttle ->\n      t = @infiniteTrigger\n      oh = document.body.offsetHeight\n      if t > 1\n        l = oh - t\n      else if t > 0\n        l = oh * t\n      else\n        return\n      if (window.innerHeight + window.scrollY) >= l\n        if @lastPage < @sess \"totalPages\"\n          @sess(\"currentPage\", @lastPage + 1)\n    , @infiniteRateLimit * 1000\n    ).bind @\n  \n  checkQueue: _.throttle ->\n    cp = @currentPage()\n    neighbors = @neighbors cp\n    \n    # If we haven't yet received the current page then clear all the other subscriptions and requests\n    # and get the current page\n    \n    if !@received[cp]\n      @clearQueue()\n      @requestPage cp\n      cp = String cp\n      for k, v of @requested\n        if k isnt cp\n          if @subscriptions[k]?\n            @subscriptions[k].stop()\n            delete @subscriptions[k]\n          delete @requested[k]\n    \n    # If we do have the current page then queue the neighbours\n    \n    else if @queue.length\n      while @queue.length > 0\n        i = @queue.shift()\n        if i in neighbors\n          @requestPage i\n          break\n  , 500\n  \n  currentPage: ->\n    if Meteor.isClient and @sess(\"currentPage\")?\n      @sess \"currentPage\"\n    else\n      @_currentPage\n  \n  isReady: ->\n    @sess \"ready\"\n  \n  ready: (p) ->\n    if p is true or p is @currentPage() and Session?\n      @sess \"ready\", true\n  \n  checkInitPage: ->\n    if @init \n      if @router\n        Router.current()?.route?.getName()\n        try\n          @initPage = parseInt(Router.current().route.params(location.href)?.page) or 1\n          @init = false\n        catch\n          return\n      else\n        @initPage = 1\n        @init = false    \n    @sess \"oldPage\", @initPage\n    @sess \"currentPage\", @initPage\n  \n  getPage: (page) ->\n    if Meteor.isClient\n      page = @currentPage()  unless page?\n      page = parseInt page\n      return  if page is NaN\n      total = @sess \"totalPages\"\n      return @ready true  if total is 0\n      \n      # Request data for the page\n      \n      if page <= total\n        @requestPage page\n        @queueNeighbors page\n        @checkQueue()\n      \n      # Return the content of this page \n      #\n      # The contents will be updated (as will the page) as data arrives from the server\n      \n      if @infinite\n        n = @PaginatedCollection.find({},\n          fields: @fields\n          sort: @sort\n        ).count()\n        c = @PaginatedCollection.find({},\n          fields: @fields\n          sort: @sort\n          skip: if @infiniteItemsLimit isnt Infinity and n > @infiniteItemsLimit then n - @infiniteItemsLimit else 0\n          limit: @infiniteItemsLimit\n        )\n      else\n        c = @PaginatedCollection.find(\n          _.object([\n            [\"_#{@id}_p\", page]\n          ]),\n          fields: @fields\n          sort: _.object([\n            [\"_#{@id}_i\", 1]\n          ])\n        )\n        c.observeChanges\n          added: =>\n            @countPages()\n          removed: =>\n            @countPages()\n      \n      c.fetch()\n  \n  # Subscribes to the given page\n  \n  requestPage: (page) ->\n    #if page not in @received\n    #  @loading page\n    return  if !page or @requested[page] or @received[page]\n    #@clearQueue()  if page is @currentPage()\n    #@queue.push page\n    @logRequest page\n    Meteor.defer ((page) ->\n      @subscriptions[page] = Meteor.subscribe @id, page,\n        onReady: ((page) ->\n          @onPage page\n        ).bind @, page\n        onError: (e) =>\n          @error e.message\n    ).bind @, page\n  \n  # Called when a page has been received\n  \n  onPage: (page) ->\n    @logResponse page\n    @ready page\n    if @infinite\n      @lastPage = page\n    @countPages()\n    @checkQueue()\n\nMeteor.Pagination = Pages\n"]}